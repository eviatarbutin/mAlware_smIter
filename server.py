import socket

from rsa import PublicKey
from constants import *
from cryptography import *



def get_user(server: socket.socket):
    server.bind((SERVER_IP, PORT))
    server.listen(NUMBER_OF_USERS)
    return server.accept()
    

def get_file(client: socket.socket):
    file_name = "temp.png"
    bytes_number_of_packets = client.recv(2)
    number_of_packets = int.from_bytes(bytes_number_of_packets,"big")
    data: bytes = b""
    for packet_index in range(number_of_packets):
        data += client.recv(BUFFER_SIZE)
    with open(file_name, "wb") as file:
        file.write(data)
    return file_name

    


def main():
    server = socket.socket()
    while True:
        client, client_address = get_user(server)
        # generateKeys(PUBLICK_SERVER, PRIVATE_SERVER)
        # public_key, private_key = loadKeys(PUBLICK_SERVER, PRIVATE_SERVER)
        while True:
            print(get_file(client))

if __name__ == "__main__":
    main()